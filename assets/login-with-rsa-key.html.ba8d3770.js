import{r as s,o as n,c as a,a as e,F as o,d as t,b as c}from"./app.ae88895a.js";const p={},i=t('<h2 id="生成-rsa" tabindex="-1"><a class="header-anchor" href="#生成-rsa" aria-hidden="true">#</a> 生成 RSA</h2><p>此处直接参考 <a href="/os/linux/generate-ssh-key">创建 SSH Key</a> 。</p><p>将生成的公钥（<code>id_rsa_new.pub</code>）拷贝。</p><h2 id="开启-rsa" tabindex="-1"><a class="header-anchor" href="#开启-rsa" aria-hidden="true">#</a> 开启 RSA</h2><h3 id="_1-登录服务器" tabindex="-1"><a class="header-anchor" href="#_1-登录服务器" aria-hidden="true">#</a> 1. 登录服务器</h3><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># xxx.xxx.xxx.xxx 为你的 ip 地址</span>\n<span class="token function">ssh</span> root@xxx.xxx.xxx.xxx\n\n<span class="token comment"># 指定密钥</span>\n<span class="token function">ssh</span> user@xxx.xxx.xxx.xxx -p port -i ~/.ssh/id_rsa_xxxx\n</code></pre></div><h3 id="_2-拷贝公钥到服务器" tabindex="-1"><a class="header-anchor" href="#_2-拷贝公钥到服务器" aria-hidden="true">#</a> 2. 拷贝公钥到服务器</h3><p>注意事项：若需要其余用户登录，则需要在该用户下创建该文件，root 下的该文件将不会生效。</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 编辑服务器认证 keys</span>\n<span class="token comment"># 若保存失败则需要先创建该文件</span>\n<span class="token function">vim</span> ～/.ssh/authorized_keys\n<span class="token comment"># 确认保存</span>\n<span class="token function">cat</span> ～/.ssh/authorized_keys\n<span class="token comment"># 内容为： ssh-rsa……</span>\n\n<span class="token comment"># 更好的形式是利用 ssh-copy-id 直接推送</span>\nssh-copy-id -i id_rsa_name.pub root@ip\n</code></pre></div><h3 id="_3-编辑-ssh-配置文件" tabindex="-1"><a class="header-anchor" href="#_3-编辑-ssh-配置文件" aria-hidden="true">#</a> 3. 编辑 SSH 配置文件</h3><p><strong>启用公钥认证</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ssh/sshd_config\n\n<span class="token comment"># 在 normal 模式下输入 “/” 进入查找模式</span>\n<span class="token comment"># 启用以下三项</span>\nRSAAuthentication <span class="token function">yes</span>     <span class="token comment"># RSA认证</span>\nPubkeyAuthentication <span class="token function">yes</span>  <span class="token comment"># 公钥认证</span>\nAuthorizedKeysFile .ssh/authorized_keys  <span class="token comment"># 公钥认证文件路径</span>\n</code></pre></div><p><strong>重启 sshd 服务</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">service</span> sshd restart\n<span class="token comment"># 或</span>\nsystemctl restart sshd\n</code></pre></div><p><strong>测试公钥登录</strong></p><p>在测试前先跳转至第四步完成本地配置。</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ssh</span> aliyun\n\n<span class="token comment"># 得到结果</span>\n<span class="token comment"># Welcome to Alibaba Cloud Elastic Compute Service !</span>\n</code></pre></div><p><strong>拒绝密码登录</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ssh/sshd_config\n\n<span class="token comment"># 在 normal 模式下输入 “/” 进入查找模式</span>\nPasswordAuthentication no <span class="token comment"># 密码认证</span>\n\n<span class="token comment"># 再执行上方的 重启 sshd 服务</span>\n</code></pre></div><p><strong>测试密码登录</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ssh</span> root@xxx.xxx.xxx.xxx\n\n<span class="token comment"># root@xxx.xxx.xxx.xxx: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span>\n</code></pre></div><p><strong>拒绝 root 用户登录</strong></p><p>在使用该项时，先完成 <a href="/os/linux/user">增加用户</a>。</p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/ssh/sshd_config\n\n<span class="token comment"># 在 normal 模式下输入 “/” 进入查找模式</span>\nPermitRootLogin no <span class="token comment"># 禁止 root 登录</span>\nAllowUsers shanyuhai <span class="token comment"># 允许登录的用户</span>\n\n<span class="token comment"># 再执行上方的 重启 sshd 服务</span>\n</code></pre></div><p><strong>测试 root 用户登录</strong></p><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">ssh</span> aliyun\n\n<span class="token comment"># root@47.112.26.219: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span>\n\n<span class="token comment"># 修改 4.快速访问服务器 的 User 为 User shanyuhai</span>\n</code></pre></div><h3 id="_4-其他配置" tabindex="-1"><a class="header-anchor" href="#_4-其他配置" aria-hidden="true">#</a> 4. 其他配置</h3><ol><li>修改默认的 22 端口 <code>Port</code></li><li>禁用空密码</li></ol><h2 id="设置文件权限" tabindex="-1"><a class="header-anchor" href="#设置文件权限" aria-hidden="true">#</a> 设置文件权限</h2>',29),r=c("关于 "),h={href:"https://zh.wikipedia.org/wiki/Chmod",target:"_blank",rel:"noopener noreferrer"},l=c("chmod"),d=c("，对文件设置权限可以很好的保护系统。"),x=t('<div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh/\n</code></pre></div><h2 id="快速访问服务器" tabindex="-1"><a class="header-anchor" href="#快速访问服务器" aria-hidden="true">#</a> 快速访问服务器</h2><div class="language-bash ext-sh"><pre class="language-bash"><code><span class="token comment"># 编辑 config 文件</span>\n<span class="token function">vim</span> ~/.ssh/config\n\n<span class="token comment"># 在 config 文件末尾追加内容</span>\nHost aliyun                  \t\t<span class="token comment"># 一个便于你区别这是哪台机器的名字</span>\n    HostName xxx.xxx.xxx.xxx  <span class="token comment"># 目的机器的ip</span>\n    User root         \t\t<span class="token comment"># ssh登陆时候的用户名</span>\n    Port <span class="token number">22</span>               \t\t<span class="token comment"># ssh所使用的端口，默认是22</span>\n    IdentityFile /home/yuan/.ssh/id_rsa_new    <span class="token comment"># 对应服务器公钥的本地私钥文件路径</span>\n</code></pre></div>',3);p.render=function(t,c){const p=s("OutboundLink");return n(),a(o,null,[i,e("p",null,[r,e("a",h,[l,e(p)]),d]),x],64)};export default p;
