(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{521:function(t,s,a){"use strict";a.r(s);var n=a(31),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),a("p",[t._v("期望代理域名为 "),a("code",[t._v("*.frp.example.com")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"frp-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frp-配置"}},[t._v("#")]),t._v(" FRP 配置")]),t._v(" "),a("blockquote",[a("p",[t._v("此处不探讨如何配置 frpc（客户端）。")])]),t._v(" "),a("h3",{attrs:{id:"frps-ini"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#frps-ini"}},[t._v("#")]),t._v(" frps.ini")]),t._v(" "),a("p",[t._v("创建 "),a("code",[t._v("frps.ini")]),t._v(" 文件：")]),t._v(" "),a("div",{staticClass:"language-ini extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ini"}},[a("code",[a("span",{pre:!0,attrs:{class:"token selector"}},[t._v("[common]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("bind_port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" {{ .Envs.FRP_SERVER_PORT }}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("token")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" {{ .Envs.FRP_SERVER_TOKEN }}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# subdomain")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("vhost_http_port")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" {{ .Envs.FRP_VHOST_HTTP_PORT }}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("subdomain_host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),t._v(" {{ .Envs.FRP_SUBDOMAIN_HOST }}")]),t._v("\n")])])]),a("h3",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" docker compose")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3.7"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("frps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frps\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fatedier/frps"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v0.36.2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" frps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("c /app/frps.ini\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" traefik\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# frps server")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 7000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7000")]),t._v("\n    \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# vhost")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/timezone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./frps.ini"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/app/frps.ini"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("ro\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" FRP_SERVER_PORT=24622\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" FRP_SERVER_TOKEN=tencentcloud_frp_token\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" FRP_VHOST_HTTP_PORT=80\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" FRP_SUBDOMAIN_HOST=frp.example.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.enable=true"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.docker.network=traefik"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# http entrypoints")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp.entrypoints=web"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp.rule=HostRegexp(`{subdomain:[a-z]+}.frp.example.com`)"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp.middlewares=https-redirect@file"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# https entrypoints")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.entrypoints=websecure"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.rule=HostRegexp(`{subdomain:[a-z]+}.frp.example.com`)"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.tls=true"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.tls.certresolver=le-dns"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.tls.domains[0].main=frp.example.com"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.tls.domains[0].sans=*.frp.example.com"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指向 80 vhost")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.routers.frp-secure.service=frp-proxy"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"traefik.http.services.frp-proxy.loadbalancer.server.port=80"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("logging")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"json-file"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("max-size")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1m"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 先创建外部网卡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker network create traefik")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("traefik")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("external")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])])]),a("h2",{attrs:{id:"traefik-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traefik-配置"}},[t._v("#")]),t._v(" Traefik 配置")]),t._v(" "),a("p",[t._v("创建文件：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" acme-dns\n")])])]),a("p",[t._v("在 "),a("a",{attrs:{href:"https://docs.shanyuhai.top/backend/traefik/quick-start.html#%E6%9C%80%E7%BB%88%E9%85%8D%E7%BD%AE",target:"_blank",rel:"noopener noreferrer"}},[t._v("最终配置"),a("OutboundLink")],1),t._v(" 上增加：")]),t._v(" "),a("div",{staticClass:"language-yml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3.7'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 省略其他")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("traefik")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ACME_DNS_API_BASE=https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//auth.acme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dns.io\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ACME_DNS_STORAGE_PATH=/acme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dns\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tls dns")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--certificatesresolvers.le-dns.acme.email=acme@example.com"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--certificatesresolvers.le-dns.acme.storage=acme.json"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--certificatesresolvers.le-dns.acme.keyType=EC384"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--certificatesresolvers.le-dns.acme.dnsChallenge.provider=acme-dns"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./acme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/acme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dns"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("rw\n")])])]),a("p",[t._v("第一次执行 "),a("code",[t._v("docker-compose up")]),t._v(" 后可以获取 "),a("code",[t._v("acme-dns")]),t._v(" 信息：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('{\n    "frp.example.com": {\n        "FullDomain": "187gf679-4961-4ave-a211-bc77ead16918.auth.acme-dns.io",\n        "SubDomain": "c9866200-2abb-45c6-82e6-396adcd1f625",\n        "Username": "9b9fc433-c218-4c61-b37e-1da73551c538",\n        "Password": "MPhWrfzZwgeZKyGK3cYPLIdgllNbmF5tFutacpFF"\n    }\n}\n')])])]),a("p",[t._v("登录到你的 DNS 帐号，创建一条 CNAME 记录 "),a("code",[t._v("_acme-challenge.frp")]),t._v(" 指向 "),a("code",[t._v("187gf679-4961-4ave-a211-bc77ead16918.auth.acme-dns.io")]),t._v("，再次执行 "),a("code",[t._v("docker-compose up")]),t._v("。")]),t._v(" "),a("p",[t._v("稍后可在 "),a("code",[t._v("acme.json")]),t._v(" 文件中找到对应的记录，即证书签发成功。")]),t._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://soulteary.com/2020/10/04/frp-in-docker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("容器化 FRP 使用方案"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://hexo.aufomm.com/2020/04/06/Traefik-2-Request-Multiple-domain-and-Wildcard-SSL-certificates/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Traefik 2 Request Multiple domain and Wildcard SSL certificates"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);