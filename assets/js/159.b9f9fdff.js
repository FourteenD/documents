(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{609:function(a,t,s){"use strict";s.r(t);var e=s(31),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("p",[a._v("Kubernetes 默认没有部署 Dashboard，不过安装也很简单：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n")])])]),s("p",[a._v("为了方便访问将 type 设置为 "),s("code",[a._v("NodePort")]),a._v("：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl edit "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kubernetes-dashboard kubernetes-dashboard\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 修改")]),a._v("\nspec:\n  clusterIP: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.97")]),a._v(".38.169\n  externalTrafficPolicy: Cluster\n  ports:\n  - nodePort: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("32576")]),a._v("\n    port: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v("\n    protocol: TCP\n    targetPort: "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8443")]),a._v("\n  selector:\n    k8s-app: kubernetes-dashboard\n  sessionAffinity: None\n  type: NodePort\n")])])]),s("p",[a._v("接着就可以查看暴露出的 Port：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl get "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" --namespace"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("kubernetes-dashboard kubernetes-dashboard\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 结果")]),a._v("\nNAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("         AGE\nkubernetes-dashboard   NodePort   "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10.97")]),a._v(".38.169   "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v(":32576/TCP   10h\n")])])]),s("p",[a._v("访问该主机和暴露出的 32576 即可。")]),a._v(" "),s("blockquote",[s("p",[a._v("注意：Chrome 访问被拒绝，可使用 Firefox。")])]),a._v(" "),s("h2",{attrs:{id:"权限"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限"}},[a._v("#")]),a._v(" 权限")]),a._v(" "),s("p",[a._v("创建一个 admin 用户：")]),a._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# dashboard-adminuser.yaml")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("---")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("admin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("user\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("dashboard\n")])])]),s("p",[a._v("获取 token：")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("kubectl -n kubernetes-dashboard get secret "),s("span",{pre:!0,attrs:{class:"token variable"}},[s("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$(")]),a._v("kubectl -n kubernetes-dashboard get sa/admin-user -o "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("jsonpath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"{.secrets[0].name}"')]),s("span",{pre:!0,attrs:{class:"token variable"}},[a._v(")")])]),a._v(" -o go-template"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"{{.data.token | base64decode}}"')]),a._v("\n")])])]),s("p",[a._v("接着就可以登录了。")])])}),[],!1,null,null,null);t.default=n.exports}}]);